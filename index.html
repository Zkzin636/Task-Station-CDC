<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Central de Tarefas</title>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; font-family: 'Roboto', sans-serif; }
  body { margin:0; background:#f5f6fa; color:#2f3640; }
  h1, h2 { text-align:center; margin:10px 0; }
  h2 { color:#487eb0; font-size:2rem; }
  .container { max-width:1000px; margin:40px auto; padding:0 15px; }
  
  /* Formulário */
  form { background:#fff; padding:25px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.1); margin-bottom:30px; display:grid; gap:15px; }
  form input, form select, form button { padding:12px; border-radius:8px; border:1px solid #dcdde1; font-size:1rem; width:100%; transition: all 0.3s; }
  form input:focus, form select:focus { border-color:#487eb0; outline:none; }
  form button { background:#487eb0; color:#fff; font-weight:500; border:none; cursor:pointer; transition: background 0.3s; }
  form button:hover { background:#40739e; }

  /* Cards de resumo */
  .resumo { display:grid; grid-template-columns:repeat(auto-fit, minmax(150px,1fr)); gap:20px; margin-bottom:30px; }
  .resumo-card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); text-align:center; }
  .resumo-card h3 { margin:0; font-size:1.2rem; color:#2f3640; }
  .resumo-card p { margin:5px 0 0 0; font-size:1rem; color:#718093; }

  /* Filtros */
  .filtros { display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px; }
  .filtros input, .filtros select { flex:1; padding:10px; border-radius:8px; border:1px solid #dcdde1; font-size:1rem; }
  
  /* Lista de tarefas */
  .tarefas { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:20px; }
  .card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition: transform 0.2s; }
  .card:hover { transform:translateY(-5px); }
  .card h3 { margin:0 0 10px 0; font-size:1.2rem; color:#2f3640; }
  .card p { margin:5px 0; font-size:0.9rem; color:#718093; }
  .status { display:inline-block; padding:5px 10px; border-radius:12px; font-weight:500; font-size:0.85rem; color:#000; }
  .Pendente { background: #FF0000; }
  .andamento { background:#FFFF00; }
  .Concluido { background:#44bd32; }

    .delete-btn {
    background:#000;
    color:#fff;
    border:none;
    border-radius:8px;
    padding:8px 12px;
    font-size:0.9rem;
    cursor:pointer;
    margin-top:10px;
    transition:background 0.3s;
  }
  .delete-btn:hover { background: #000; }


  @media(max-width:600px){ .container{margin:20px;padding:10px;} .filtros{flex-direction:column;} }
</style>
</head>
<body>
<h2>TASK STATION</h2>
<div class="container">

  <!-- Formulário de cadastro -->
  <form id="tarefaForm">
    <h1>Cadastro de Tarefa - EMPRESA</h1>
    <input type="text" id="uid" placeholder="UID do Cartão" required>
    <input type="text" id="nome" placeholder="Nome do Funcionário" required>
      <div style="position: relative;">
        <input type="text" id="tarefa" placeholder="Tarefa" maxlength="20" required>
        <span id="contador" style="position: absolute; right: 50px; bottom: 10px; font-size: 0.8rem; color: #000;">0/20</span>
      </div>
    <input type="date" id="data" required>
    <select id="status">
      <option value="Pendente">Pendente</option>
      <option value="Em andamento">Em andamento</option>
      <option value="Concluido">Concluído</option>
    </select>
    <button type="submit">Salvar</button>
  </form>

  <!-- Resumo geral -->
  <div class="resumo">
    <div class="resumo-card"><h3 id="totalTarefas">0</h3><p>Total de Tarefas</p></div>
    <div class="resumo-card"><h3 id="pendentes">0</h3><p>Pendentes</p></div>
    <div class="resumo-card"><h3 id="andamento">0</h3><p>Em andamento</p></div>
    <div class="resumo-card"><h3 id="concluidas">0</h3><p>Concluídas</p></div>
  </div>

  <!-- Filtros -->
  <div class="filtros">
    <input type="text" id="buscaFuncionario" placeholder="Buscar por funcionário ou UID">
    <select id="filtroStatus">
      <option value="">Todos os Status</option>
      <option value="Pendente">Pendente</option>
      <option value="Em andamento">Em andamento</option>
      <option value="Concluido">Concluído</option>
    </select>
  </div>

  <!-- Lista de tarefas -->
  <div class="tarefas" id="tarefasContainer"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA5WxwdSMRwX3yDhj5d9xC0iC73CtrIIas",
  authDomain: "projete21.firebaseapp.com",
  databaseURL: "https://projete21-default-rtdb.firebaseio.com",
  projectId: "projete21",
  storageBucket: "projete21.firebasestorage.app",
  messagingSenderId: "1057782656450",
  appId: "1:1057782656450:web:2cceac74cba0d7ebf67a5b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const tarefasContainer = document.getElementById("tarefasContainer");
const totalTarefasEl = document.getElementById("totalTarefas");
const pendentesEl = document.getElementById("pendentes");
const andamentoEl = document.getElementById("andamento");
const concluidasEl = document.getElementById("concluidas");
const buscaFuncionario = document.getElementById("buscaFuncionario");
const filtroStatus = document.getElementById("filtroStatus");

// SALVAR TAREFA COM PREFIXO tarefaX
document.getElementById("tarefaForm").addEventListener("submit", function(e){
  e.preventDefault();
  const uid = document.getElementById("uid").value;
  const nome = document.getElementById("nome").value;
  const tarefa = document.getElementById("tarefa").value;
  const data = document.getElementById("data").value;
  const status = document.getElementById("status").value;

  const novaTarefa = { descricao: tarefa, status: status, data: data };

  db.ref("funcionarios/"+uid+"/tarefas").once("value", function(snapshot){
    const total = snapshot.numChildren() + 1;
    const chave = "tarefa" + total; // Exemplo: tarefa1, tarefa2...
    db.ref("funcionarios/"+uid+"/tarefas/"+chave).set(novaTarefa);
    db.ref("funcionarios/"+uid).update({ nome: nome, data: data });
    document.getElementById("tarefaForm").reset();
  });
});

// Função para carregar tarefas e atualizar resumo
function carregarTarefas(){
  db.ref("funcionarios").on("value", function(snapshot){
    tarefasContainer.innerHTML = "";
    let total=0, pend=0, andamento=0, concl=0;
    snapshot.forEach(function(funcSnap){
      const funcionario = funcSnap.val();
      const uid = funcSnap.key;
      if(funcionario.tarefas){
        Object.keys(funcionario.tarefas).forEach(function(key){
          const tarefa = funcionario.tarefas[key];
          total++;
          if(tarefa.status=="Pendente") pend++;
          else if(tarefa.status=="Em andamento") andamento++;
          else if(tarefa.status=="Concluido") concl++;
          // Cria card
          const card = document.createElement("div");
          card.className="card";
          card.innerHTML=`
            <h3>${funcionario.nome}</h3>
            <p><strong>UID:</strong> ${uid}</p>
            <p><strong>Chave:</strong> ${key}</p>
            <p><strong>Descrição:</strong> ${tarefa.descricao}</p>
            <p><strong>Data:</strong> ${tarefa.data}</p>
            <p><strong>Status:</strong> <span class="status ${tarefa.status}">${tarefa.status}</span></p>
            <button class="delete-btn" onclick="removerTarefa('${uid}','${key}')">Excluir</button>
          `;
          tarefasContainer.appendChild(card);
        });
      }
    });
    // Atualiza resumo
    totalTarefasEl.textContent=total;
    pendentesEl.textContent=pend;
    andamentoEl.textContent=andamento;
    concluidasEl.textContent=concl;
    aplicarFiltros();
  });
}

// Filtros e busca
function aplicarFiltros(){
  const busca = buscaFuncionario.value.toLowerCase();
  const statusFiltro = filtroStatus.value;
  Array.from(tarefasContainer.children).forEach(card=>{
    const nome = card.querySelector("h3").textContent.toLowerCase();
    const uid = card.querySelector("p").textContent.toLowerCase();
    const status = card.querySelector(".status").textContent;
    const mostra = 
      (nome.includes(busca) || uid.includes(busca)) &&
      (statusFiltro=="" || status==statusFiltro);
    card.style.display = mostra ? "block" : "none";
  });
}
function removerTarefa(uid, chave) {
  if(confirm("Deseja realmente excluir esta tarefa?")) {
    db.ref("funcionarios/" + uid + "/tarefas/" + chave).remove()
      .then(() => {
        alert("Tarefa removida com sucesso!");
      })
      .catch((err) => {
        console.error("Erro ao remover tarefa:", err);
        alert("Erro ao remover tarefa: " + err.message);
      });
  }
}
// Contador de caracteres para o campo tarefa
const tarefaInput = document.getElementById("tarefa");
const contadorEl = document.getElementById("contador");
const maxChars = tarefaInput.maxLength; // 20

tarefaInput.addEventListener("input", function() {
  const len = tarefaInput.value.length;
  contadorEl.textContent = `${len}/${maxChars}`;
});


buscaFuncionario.addEventListener("input", aplicarFiltros);
filtroStatus.addEventListener("change", aplicarFiltros);

carregarTarefas();
</script>
</body>
</html>
